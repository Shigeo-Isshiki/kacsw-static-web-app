# vc-check 使い方リファレンス

`src/vc-check.js` はビデオ会議（主に Zoom）に関する入力検証・正規化ユーティリティを提供します。
フォーム入力や kintone のカスタム画面上で、ミーティングID・パスコード・URL の妥当性チェックと半角化を安全に行うためのヘルパー群です。

---

## 概要

主な目的はユーザが入力した値を全角文字や類似ハイフンを含む場合に半角に正規化し、さらにフォーマットの妥当性を検証して例外を投げることです。ブラウザ/Node 双方で利用できる同期関数として実装されており、ブラウザではファイル末尾で `window` に公開されます。

主な機能:

- ミーティング/ウェビナーID の半角化と桁数検証
- パスコードの半角化と文字種・長さ検証
- Zoom URL の半角化・スキーム検証・ドメイン正規化

---

## 公開 API サマリ

- `validateZoomMeetingId(id, isWebinar = false)`
  - 説明: 入力を半角化し、ミーティングID（10 or 11 桁）またはウェビナーID（11桁）かを検証します。空白は許容されますが、空白を除いた桁数で判定されます。
  - 戻り値: 正規化済み（半角）文字列
  - 例外: 型不正、非許容文字、桁数不正なら `Error`

- `validateZoomPasscode(passcode)`
  - 説明: 全角英数字・記号を半角に変換後、6〜10 文字の半角英数字・記号のみであることを検証します。
  - 戻り値: 正規化済み（半角）パスコード
  - 例外: 型不正、長さ不正、非 ASCII 文字が残る場合は `Error`

- `validateZoomUrl(url)`
  - 説明: 全角→半角化を行い、`https://` で始まり、かつ `zoom.us` を含むことを確認します。`zoom.us` 部分を小文字化して返します。
  - 戻り値: 正規化済み URL（`zoom.us` は小文字）
  - 例外: 型不正、`https://` で始まらない場合や `zoom.us` が含まれない場合は `Error`

---

## 補助関数

内部で以下のヘルパが使われています（公開はされていませんが挙動の参考になります）:

- `_vc_toHalfWidth(str)` — 全角英数字・記号・全角スペースを半角に変換し、変換後に半角 ASCII 範囲外の文字が含まれると `Error` を投げます。ハイフン類（全角・全角ダッシュなど）を半角ハイフン `-` に正規化します。

---

## 使用例

```js
// Node で読み込む場合の例
global.window = global; // テスト環境向け
require('./src/vc-check.js');

// ミーティングID
validateZoomMeetingId('123 456 7890'); // -> '123 456 7890' (半角化のみ、桁数チェック通過)

// ウェビナー（全角入力も許容して半角化する）
validateZoomMeetingId('１２３４５６７８９０１', true); // -> '12345678901'

// パスコード
validateZoomPasscode('ＡＢC１２3!'); // -> 'ABC123!'

// URL 正規化（zoom.us 部分を小文字化）
validateZoomUrl('ｈｔｔｐｓ：//Example.ZOOM.US/j/１２３４５６７８９０?pwd=ＡＢＣ');
// -> 'https://Example.zoom.us/j/1234567890?pwd=ABC'
```

---

## テストと運用ヒント

- 入力検証は厳格です。ユーザ入力で全角かな・漢字等が混入している場合は `_vc_toHalfWidth` が例外を投げます。フォーム側で事前に入力制御（入力マスク・プレースホルダ）を追加することを推奨します。
- URL の判定は単純に `zoom.us` を含むかどうかで行います（サブドメインやパスを厳密に検査する場合は追加の検証を行ってください）。
- テストファイル: このリポジトリでは `test/test-vc-check.js` を用意しています。正常系・異常系（桁数不足、短すぎるパスコード、非 ASCII 混入、https 必須、zoom.us 欠如）をカバーしています。CI に組み込まれている場合は `npm run test` で自動実行されます。

---

必要であれば、関数ごとの戻り値や投げられる `Error` メッセージの正確な一覧（メッセージ文字列）や内部の正規表現定義（`_VC_HYPHEN_REGEX` 等）を追記します。どのレベルの詳細が欲しいですか？
